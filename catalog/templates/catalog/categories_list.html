{% extends 'catalog/base.html' %}

{% block title %}–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ - Skystore{% endblock %}

{% block content %}
<div class="container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="display-5 fw-bold">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤</h1>

        {% if user.is_authenticated %}
        <a href="{% url 'catalog:category_create' %}" class="btn btn-success">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        </a>
        {% endif %}
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—ç—à–µ -->
    {% if from_cache %}
    <div class="alert alert-success alert-dismissible fade show mb-4">
        ‚ö°Ô∏è –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –∫—ç—à–∞
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}

    <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    {% if categories %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for category in categories %}
            {% if category.slug %}  <!-- ‚Üê –î–û–ë–ê–í–¨–¢–ï –≠–¢–£ –ü–†–û–í–ï–†–ö–£! -->
            <div class="col">
                <div class="card h-100 shadow-sm category-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h5 class="card-title mb-0">{{ category.name }}</h5>
                            <span class="badge bg-primary">
                                {{ category.product_set.count }} —Ç–æ–≤–∞—Ä–æ–≤
                            </span>
                        </div>

                        {% if category.description %}
                        <p class="card-text text-muted">
                            {{ category.description|truncatechars:100 }}
                        </p>
                        {% endif %}

                        <div class="mt-3">
                            <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ slug –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π URL -->
                            {% if category.slug %}
                            <a href="{% url 'catalog:category_products' slug=category.slug %}"
                               class="btn btn-primary btn-sm">
                                üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–≤–∞—Ä—ã
                            </a>
                            {% else %}
                            <button class="btn btn-secondary btn-sm" disabled>
                                ‚ö†Ô∏è –ù–µ—Ç slug
                            </button>
                            {% endif %}

                            {% if user.is_authenticated %}
                            <div class="btn-group mt-2">
                                {% if category.slug %}
                                <a href="{% url 'catalog:category_update' slug=category.slug %}"
                                   class="btn btn-outline-warning btn-sm">
                                    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </a>
                                <a href="{% url 'catalog:category_delete' slug=category.slug %}"
                                   class="btn btn-outline-danger btn-sm">
                                    üóë –£–¥–∞–ª–∏—Ç—å
                                </a>
                                {% else %}
                                <button class="btn btn-outline-warning btn-sm" disabled>
                                    ‚úèÔ∏è –ù–µ—Ç slug
                                </button>
                                <button class="btn btn-outline-danger btn-sm" disabled>
                                    üóë –ù–µ—Ç slug
                                </button>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="card-footer bg-transparent">
                        <small class="text-muted d-flex justify-content-between">
                            <span>
                                {% if category.slug %}
                                URL: /category/{{ category.slug }}/
                                {% else %}
                                ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç slug
                                {% endif %}
                            </span>
                            {% if user.is_superuser %}
                            <span>ID: {{ category.id }}</span>
                            {% endif %}
                        </small>
                    </div>
                </div>
            </div>
            {% endif %}
        {% endfor %}
    </div>
    {% else %}
    <!-- –ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <div class="text-center py-5">
        <div class="display-1 mb-4">üì≠</div>
        <h3 class="mb-3">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
        <p class="lead mb-4">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤</p>

        {% if user.is_authenticated %}
        <a href="{% url 'catalog:category_create' %}" class="btn btn-success btn-lg">
            ‚ûï –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        </a>
        {% else %}
        <a href="{% url 'users:login' %}" class="btn btn-primary btn-lg">
            üîë –í–æ–π—Ç–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        </a>
        {% endif %}
    </div>
    {% endif %}

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="mt-4 pt-3 border-top">
        <div class="d-flex justify-content-between">
            <a href="{% url 'catalog:product_list' %}" class="btn btn-outline-primary">
                üõç –í—Å–µ —Ç–æ–≤–∞—Ä—ã
            </a>
            <a href="{% url 'catalog:home' %}" class="btn btn-outline-secondary">
                üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </a>
        </div>
    </div>
</div>

<style>
.category-card {
    transition: transform 0.2s;
    border: 1px solid #e0e0e0;
}
.category-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.category-card .card-footer {
    background-color: rgba(0,0,0,0.02);
}
</style>
{% endblock %}